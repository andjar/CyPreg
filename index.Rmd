---
title: "The Cytokine in Pregnancy Database"
output: 
  flexdashboard::flex_dashboard:
    orientation: rows
---

```{r setup, include=FALSE}
library(flexdashboard)
library(ggplot2)
library(plotly)
library(DT)
source("R/load_data.R")
source("R/export_data.R")
```

# Overview {data-icon="fa-home"}

## Row

### Studies

```{r}
valueBox(nrow(df_studies), icon = "fa-file-alt")
```

### Aggregated data points

```{r}
valueBox(nrow(df_aggregated), icon = "fa-filter")
```

### Raw data points

```{r}
valueBox(nrow(df_raw), icon = "fa-chart-bar")
```

### Participants

```{r}
valueBox(sum(df_studies$ntot), icon = "fa-female")
```

### Different cytokines

```{r}
valueBox(nrow(cytokines), icon = "fa-snowflake")
```

## Row

### Studies

```{r}
datatable(df_studies[,c("author","year","title","doi","design","type")], class = 'cell-border stripe')
```

### Usage {data-width="150"}

Download

-   [Aggregated data](./aggregated_data.csv)
-   [Raw data](./aggregated_data.csv)

License:

Citation:

# Details {data-icon="fa-info"}

## Row

### Aggregated

```{r}
df_aggregated_summarized <- aggregate(data = merge(df_aggregated, cytokines), value ~ author + title + condition + printname, FUN = length)
datatable(df_aggregated_summarized, class = 'cell-border stripe', rownames = FALSE)
```

### Aggregated

```{r}
ggplotly(
  ggplot(merge(df_aggregated,cytokines), aes(printname)) + geom_bar() + 
    theme_bw() + 
    labs(x = "Cytokine", y = "Number of observations") + 
    theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
)

#ggplot(df_aggregated, aes(ga_days.mean, value, group = filename)) + geom_point() + geom_line() + facet_wrap(~cytokine, scales = "free") + theme_bw()
```

## Row

### Raw

```{r}
#ggplot(merge(df_aggregated,cytokines), aes(printname)) + geom_bar() + 
#  theme_bw() + 
#  labs(x = "Cytokine", y = "Number of observations") + 
#  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
```

# Contribute {data-icon="fa-hands-helping"}

## Row

### How to contribute

Feel free to contribute! The easiest way to contribute is through [github](https://github.com/andjar/CyPreg) and is described step-wise below.

1.  If you are new to git, [this guide](https://www.dataschool.io/how-to-contribute-on-github/) can help you getting started. The repository for the database is `https://github.com/andjar/CyPreg.git`

2.  Check `data/studies.csv` (or the Overview page) to see that the study you want to add is missing from the database

3.  Add the new study to `data/studies.csv`. Here, `type` should be either `raw` or `aggregated`, and the preferred filename is of the form `firstauthorYYYY.csv` (e.g. `stokkeland2019.csv`)

4.  The data are to be added in a new .csv-file but it may be nice to use an existing file as template. Raw data live in the `data/raw` folder and aggregated data in `data/aggregated`.

5.  The data file should have a long format where each cytokine measurement has its own row. The variable names are columns with the variable name on top. Please see `data/variables.csv` for variable names

    -   If you want to append a new variable, you must also add it to `data/variables.csv` and provide a short description so that others can understand exactly what it means

    -   Please adhere to the following convention: Variable names should have the form `basename.suffix` where `basename` is added to `data/variable.csv`. Available suffixes, that are used in the csf files that contain data, are

        -   `median`: If the given value is reported as median

        -   `mean`: If the given value is reported as mean
        
        -   `sd`: If the variation in the given value is reported as standard deviation
        
        -   `percentile.%n`: If the variation in the given value is reported as the %nth percentile. Remember that range corresponds to the 0-100th percentile
        
        -   `def`: To provide details regarding a basevariable

    -   The highest and lower percentiles will be used for `basename.upper` and `basename.lower`, respectively. If standard deviation is given, upper and lower will be the corresponding value +/- 1.97 times the standard deviation

6.  Cytokine names should match the column `cytokine` in `data/cytokines.csv`
